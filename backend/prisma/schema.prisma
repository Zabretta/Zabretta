generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model admin_logs {
  id         String     @id @default(cuid())
  userId     String
  userName   String
  action     String
  targetType TargetType
  targetId   String?
  details    Json?
  ip         String?
  timestamp  DateTime   @default(now())
  users      users      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model content {
  id          String        @id @default(cuid())
  userId      String
  type        ContentType
  title       String
  description String?
  category    String?
  status      ContentStatus @default(ACTIVE)
  views       Int           @default(0)
  likes       Int           @default(0)
  comments    Int           @default(0)
  rating      Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  users       users         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notifications {
  id        Int      @id @default(autoincrement())
  userId    String
  text      String
  type      String   @default("SYSTEM")
  link      String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([read])
  @@index([userId])
}

model rating_adjustments {
  id             String   @id @default(cuid())
  userId         String
  reason         String
  ratingChange   Int
  activityChange Int
  adminId        String?
  adminNote      String?
  timestamp      DateTime @default(now())
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model setting {
  id              String   @id @default(cuid())
  userId          String   @unique
  theme           String   @default("auto")
  brightness      Int      @default(100)
  fontSize        Int      @default(100)
  showAnimations  Boolean  @default(true)
  updatedAt       DateTime @updatedAt

  users users @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("settings")
}

model users {
  id                 String               @id @default(cuid())
  login              String               @unique
  email              String               @unique
  name               String?
  avatar             String?
  role               UserRole             @default(USER)
  isActive           Boolean              @default(true)
  rating             Int                  @default(0)
  activityPoints     Int                  @default(0)
  totalPosts         Int                  @default(0)
  violations         Int                  @default(0)
  createdAt          DateTime             @default(now())
  lastLogin          DateTime?
  passwordHash       String
  refreshToken       String?
  admin_logs         admin_logs[]
  content            content[]
  notifications      notifications[]
  rating_adjustments rating_adjustments[]
  setting            setting?
}

enum ContentStatus {
  DRAFT
  ACTIVE
  ARCHIVED
  BLOCKED
}

enum ContentType {
  PROJECT
  MARKET
  HELP
  LIBRARY
}

enum TargetType {
  USER
  POST
  RATING
  SYSTEM
  CONTENT
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
}
