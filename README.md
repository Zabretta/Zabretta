# Samodelkin App

Проект для создания и управления проектами.

## Технологии
- Next.js 14
- TypeScript
- React

## Установка
\`\`\`bash
npm install
npm run dev
\`\`\`

## Запуск
\`\`\`bash
npm run dev
\`\`\`
Откройте [http://localhost:3000](http://localhost:3000)

## Автор
Рябов Георгий

Проект Samodelkin разрабатываеться как социальная сеть для талантливых людей, непосед с фантаном идей и задумок, умелыми ркуами и умной головой желающими поделиться своими мыслями 
с такими же единомышленниками,или просто желающими показать свои наработки, самоделки, конструкции, изобретения сделанные своими руками, да что угодно, выпечку, рисунки, вязания.
В общем все сделанное с любовью и интересом к делу, а так же пообщаться в личной переписке, оценить проект другого участника, подсказать что нибудь, одобрить. так же будет 
возможность продать, что либо свое через сайт.
Главная страница сайта одна и задумана как верстак, вверху есть панель инструментов с восьмью кнопками (похвалить) (поделиться) (статистика) (настройки) (комментировать) ( оформить)
(идеи) (избранное)
Центральная панель с названием сайта "Самоделкин" и кнопкой регистрации
Левая панель "Инструменты" содержит восем ящиков (лента проектов) (мастера рядом) (мои беседы)(достижения) (ищут помощи) (библиотека) (барахолка) (правила)
Правая панель "Моя мастерская" состоит из восьми ящиков (мой профиль) (мои проекты) (понравилось)(моя мастерская) (встречи)(настройки) (помощь) (выйти)
25 кнопок каждая со своим фунционалом:
1. "Присоедениться к кулибиным"- кнопка регистрации пользователя, регистрация по электронной почте, логин, пароль, фиксация IP-адреса чтобы не создавали мультиаккаунты.
ТЗ-1: Кнопка «Присоединиться к Кулибиным» (Система регистрации и авторизации)

1. Общее описание

Кнопка запускает процесс регистрации нового пользователя или авторизации существующего в социальной сети «Самоделкин». Основная цель — создать учётную запись пользователя, привязанную к email, с фиксацией IP для предотвращения мультиаккаунтов.

2. Пользовательские сценарии (User Flow)

Сценарий 2.1: Первичная регистрация нового пользователя

1. Триггер: Пользователь нажимает кнопку «Присоединиться к Кулибиным».
2. Шаг 1: Открытие модального окна. Появляется модальное окно с двумя табами: «Регистрация» (активен по умолчанию) и «Уже есть аккаунт».
3. Шаг 2: Заполнение формы регистрации. Поля:
   · email (обязательно, валидация на формат)
   · login (обязательно, уникальный, 3-20 символов)
   · password (обязательно, минимум 8 символов, цифра+буква)
   · passwordConfirm (обязательно, должно совпадать с password)
   · agreement (чекбокс "Принимаю правила сайта", обязательно).
4. Шаг 3: Отправка данных. Кнопка «Создать аккаунт». На этом этапе фронтенд отправляет IP-адрес пользователя (определяется на бэкенде) вместе с формой.
5. Шаг 4: Обработка на бэкенде. Сервер:
   · Проверяет уникальность email и login.
   · Анализирует IP-адрес (запись в signup_attempts для лимитирования попыток с одного IP, например, не более 3 аккаунтов в сутки).
   · Хэширует пароль.
   · Создает запись пользователя в статусе pending (неактивен).
   · Генерирует код подтверждения и отправляет письмо на email.
6. Шаг 5: Подтверждение email. Пользователь получает письмо со ссылкой вида /api/auth/confirm?token=abc123. Переход по ссылке активирует аккаунт (статус active).
7. Шаг 6: Автоматический вход. После подтверждения email пользователь автоматически логинится и перенаправляется на главную. Кнопка в интерфейсе меняется на «Мой профиль».

Сценарий 2.2: Вход существующего пользователя

1. Триггер: В модальном окне пользователь переключается на таб «Уже есть аккаунт».
2. Шаг 1: Заполнение формы входа. Поля: login (или email) и password.
3. Шаг 2: Отправка данных. Кнопка «Войти». IP-адрес также отправляется для логирования.
4. Шаг 3: Успешный вход. Создается сессия, пользователь перенаправляется на главную. Кнопка меняется на «Мой профиль».

Сценарий 2.3: Восстановление пароля

1. Триггер: Ссылка «Забыли пароль?» под формой входа.
2. Шаг 1: Открывается форма для ввода email.
3. Шаг 2: На email отправляется ссылка для сброса пароля с одноразовым токеном.
4. Шаг 3: Переход по ссылке открывает форму для ввода нового пароля.

---

3. Модель данных (Database Schema)

```javascript
// Модель User (Пользователь)
{
  _id: ObjectId,
  email: { type: String, unique: true, required: true },
  login: { type: String, unique: true, required: true },
  passwordHash: { type: String, required: true }, // bcrypt hash
  status: { type: String, enum: ['pending', 'active', 'banned'], default: 'pending' },
  ipHistory: [ // История IP-адресов для входа
    {
      ip: String,
      userAgent: String,
      timestamp: Date
    }
  ],
  profile: {
    displayName: String,
    avatarUrl: String,
    bio: String,
    city: String
  },
  emailConfirmationToken: String,
  emailConfirmationExpires: Date,
  resetPasswordToken: String,
  resetPasswordExpires: Date,
  createdAt: Date,
  lastLoginAt: Date
}

// Модель SignupAttempt (Попытка регистрации - для контроля по IP)
{
  _id: ObjectId,
  ipAddress: String,
  attemptCount: Number,
  lastAttempt: Date,
  blockedUntil: Date // Если превышен лимит
}
```

---

4. API-эндпоинты (Backend Specification)

Все эндпоинты находятся по пути /api/auth/.

POST /api/auth/register — Регистрация

Запрос (Request Body):

```json
{
  "email": "user@example.com",
  "login": "master_ivan",
  "password": "SecurePass123",
  "passwordConfirm": "SecurePass123",
  "agreement": true
}
```

Успешный ответ (201 Created):

```json
{
  "success": true,
  "message": "Письмо с подтверждением отправлено на ваш email.",
  "userId": "507f1f77bcf86cd799439011"
}
```

Заглушка для фронтенда (Frontend Mock):

```javascript
// Временно эмулируем успешную регистрацию без бэкенда
const mockRegister = async (userData) => {
  console.log('Заглушка: Регистрация', userData);
  // Сохраняем данные в localStorage для демо
  localStorage.setItem('demo_user', JSON.stringify({
    ...userData,
    id: 'demo_' + Date.now(),
    status: 'pending'
  }));
  return { success: true, message: 'Регистрация успешна (демо-режим)' };
};
```

POST /api/auth/login — Вход

Запрос:

```json
{
  "login": "master_ivan или user@example.com",
  "password": "SecurePass123"
}
```

Успешный ответ (200 OK):

```json
{
  "success": true,
  "token": "jwt_token_here", // Или sessionId
  "user": {
    "id": "507f1f77bcf86cd799439011",
    "login": "master_ivan",
    "email": "user@example.com"
  }
}
```

GET /api/auth/confirm?token=abc123 — Подтверждение email

(Бэкенд, фронтенд лишь переходит по ссылке из письма)

POST /api/auth/logout — Выход

POST /api/auth/forgot-password — Запрос на сброс пароля

POST /api/auth/reset-password — Сброс пароля по токену

---

5. Интерфейс и состояние (Frontend UI/UX)

· До нажатия кнопки: Кнопка «Присоединиться к Кулибиным» в центре главной панели.
· После нажатия: Модальное окно (AuthModal.tsx) с табами.
· После успешного входа: Кнопка меняется на «Мой профиль» (ведет в личный кабинет).

Состояние (React State):

```typescript
// В Workbench.tsx или контексте приложения
const [authState, setAuthState] = useState<{
  isAuthenticated: boolean;
  user: null | { id: string; login: string; email: string };
  authModalOpen: boolean;
}>({
  isAuthenticated: false,
  user: null,
  authModalOpen: false
});
```

---

6. Меры безопасности (Security)

1. Пароли: Хранение только bcrypt-хеша.
2. IP-контроль: Ограничение регистраций (например, 3 аккаунта/IP/24ч). Таблица SignupAttempt.
3. Сессии: Использование httpOnly cookies или JWT в localStorage с коротким сроком жизни.
4. Email-подтверждение: Обязательный шаг для активации.
5. Защита от ботов: Простая капча или Cloudflare Turnstile на этапе регистрации (можно добавить позже).

---

7. Пошаговый план реализации (Milestones)

1. Неделя 1: Проектирование и создание модального окна AuthModal.tsx с формами (UI только).
2. Неделя 2: Реализация логики состояния (React) и заглушек API (все работает на фронтенде с localStorage).
3. Неделя 3: Разработка бэкенд-API (Node.js + Express + MongoDB) с эндпоинтами регистрации/логина.
4. Неделя 4: Интеграция фронтенда с реальным API, добавление подтверждения email, восстановления пароля.

---

8. Готовый фрагмент кода для начала (AuthModal.tsx)

```tsx
"use client";

import { useState } from 'react';

type AuthMode = 'register' | 'login';

export default function AuthModal({ isOpen, onClose }: { isOpen: boolean; onClose: () => void }) {
  const [mode, setMode] = useState<AuthMode>('register');
  const [formData, setFormData] = useState({
    email: '',
    login: '',
    password: '',
    passwordConfirm: '',
    agreement: false,
  });
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    
    // Заглушка API
    if (mode === 'register') {
      console.log('Регистрация:', formData);
      // ВРЕМЕННО: сохраняем в localStorage
      localStorage.setItem('samodelkin_demo_user', JSON.stringify({
        email: formData.email,
        login: formData.login,
        status: 'pending'
      }));
      alert('Демо-режим: регистрация прошла успешно! Проверьте консоль.');
    } else {
      console.log('Вход:', { login: formData.login, password: formData.password });
      alert('Демо-режим: вход успешен!');
    }
    
    setIsLoading(false);
    onClose(); // Закрываем модалку после "успешной" отправки
  };

  if (!isOpen) return null;

  return (
    <div className="auth-modal-overlay">
      <div className="auth-modal">
        <div className="auth-modal-tabs">
          <button className={mode === 'register' ? 'active' : ''} onClick={() => setMode('register')}>
            Регистрация
          </button>
          <button className={mode === 'login' ? 'active' : ''} onClick={() => setMode('login')}>
            Уже есть аккаунт
          </button>
        </div>

        <form onSubmit={handleSubmit}>
          {mode === 'register' && (
            <input
              type="email"
              placeholder="Email"
              value={formData.email}
              onChange={(e) => setFormData({...formData, email: e.target.value})}
              required
            />
          )}
          
          <input
            type="text"
            placeholder="Логин"
            value={formData.login}
            onChange={(e) => setFormData({...formData, login: e.target.value})}
            required
          />
          
          <input
            type="password"
            placeholder="Пароль"
            value={formData.password}
            onChange={(e) => setFormData({...formData, password: e.target.value})}
            required
          />
          
          {mode === 'register' && (
            <>
              <input
                type="password"
                placeholder="Повторите пароль"
                value={formData.passwordConfirm}
                onChange={(e) => setFormData({...formData, passwordConfirm: e.target.value})}
                required
              />
              <label>
                <input
                  type="checkbox"
                  checked={formData.agreement}
                  onChange={(e) => setFormData({...formData, agreement: e.target.checked})}
                  required
                />
                Принимаю правила сайта
              </label>
            </>
          )}

          <button type="submit" disabled={isLoading}>
            {isLoading ? 'Отправка...' : mode === 'register' ? 'Создать аккаунт' : 'Войти'}
          </button>
        </form>

        <button className="close-modal" onClick={onClose}>✕</button>
      </div>
    </div>
  );
}
`
2. "Правила"- кнопка для информации о правилах поведения, общения и пользования сайтом.
3. "Барахолка"- кнопка открытия магазина где можно продать свои самоделки, поделки, кулинарные изделия а так же предложить свои услуги. Должно быть что то вроде доски обьявления 
по несколким разделам с удобным интерфейсом "продам" "куплю" "услуги" ползователь сможет через сайт заказать и оплатить товар или услугу с доставкой курьером или почтой.

ТЗ-3: Кнопка «Барахолка» (Маркетплейс сообщества с платежами и логистикой)

1. Общее описание

Кнопка открывает полноценный маркетплейс внутри сообщества «Самоделкин». Пользователи могут моментально публиковать товары и услуги, проводить безопасные сделки через встроенную кассу (Сбер) или договариваться самостоятельно, выбирать удобную доставку (СДЭК, Яндекс Доставка) и накапливать репутацию, которая влияет на доверие в рамках всего сайта.

2. Пользовательские сценарии (User Flow)

Сценарий 3.1: Публикация товара/услуги

1. Триггер: Авторизованный пользователь в разделе «Барахолка» нажимает «+ Продать».
2. Форма создания:
   · Тип: Товар / Услуга (радиокнопка).
   · Заголовок, описание, категория.
   · Цена: В рублях. Чекбоксы «Цена договорная», «Возможен торг».
   · Фотографии: Загрузка до 10 изображений, первое — главное.
   · Состояние: Новое / Б/у (для товара).
   · Вес и габариты (для автоматического расчёта доставки).
   · Локация: Город (по умолчанию из профиля). Важно: Отмечается, доступна ли «Яндекс Доставка» (для Екатеринбурга).
3. Публикация: После сохранения объявление сразу публикуется (status: 'active').

Сценарий 3.2: Покупка со встроенным платежом и доставкой (полный цикл)

1. Выбор: Покупатель нажимает «Купить» на карточке товара.
2. Оформление заказа: Открывается модальное окно:
   · Способ оплаты: «Онлайн (Сбер)» / «При встрече».
   · Способ получения: «Доставка» / «Самовывоз».
     · При выборе «Доставка»:
       · Если продавец в Екатеринбурге — показывается вариант «Яндекс Доставка» с расчётом стоимости.
       · Для межгорода — выбор «СДЭК» (пункт выдачи или курьер) с расчётом через API СДЭК.
   · Адрес/пункт выдачи.
   · Итоговая сумма: Цена товара + стоимость доставки.
3. Оплата: При выборе «Онлайн (Сбер)» пользователь перенаправляется на защищённую платежную страницу Сбера. После успешной оплаты:
   · Продавец получает уведомление.
   · Статус заказа меняется на «Оплачен, ожидает отправки».
   · Деньги замораживаются на escrow-счёте системы.
4. Отправка: Продавец передаёт заказ в выбранную службу доставки и вводит трек-номер в системе.
5. Получение и подтверждение: Покупатель получает заказ и в интерфейсе нажимает «Получил, всё в порядке». Деньги размораживаются и переводятся продавцу.
6. Обмен отзывами: Система предлагает обеим сторонам оставить публичный отзыв и оценку (1-5 звёзд).

Сценарий 3.3: Покупка с оплатой «При встрече»
Покупатель выбирает этот вариант. Система лишь помогает договориться, фиксируя сделку и создавая чат между пользователями. После личной встречи и расчёта продавец вручную отмечает заказ как «Завершён», и система начисляет рейтинг.

3. Модель данных (Database Schema)

```javascript
// Модель MarketItem (расширенная)
{
  _id: ObjectId,
  authorId: ObjectId,
  type: { type: String, enum: ['product', 'service'], required: true },
  title: String,
  description: String,
  category: String,
  price: { amount: Number, currency: String, isNegotiable: Boolean },
  condition: { type: String, enum: ['new', 'used'], default: 'new' }, // для товара
  specs: { weight: Number, dimensions: { length: Number, width: Number, height: Number } }, // для расчёта доставки
  images: [String],
  status: { type: String, enum: ['active', 'sold', 'archived'], default: 'active' },
  location: { city: String, yandexDeliveryAvailable: Boolean }, // Флаг доступности Яндекс Доставки
  contactInfo: Object,
  createdAt: Date,
  updatedAt: Date,
  views: Number
}

// Модель Order (Заказ)
{
  _id: ObjectId,
  itemId: ObjectId,
  buyerId: ObjectId,
  sellerId: ObjectId,
  status: { type: String, enum: ['created', 'paid', 'shipped', 'delivered', 'completed', 'cancelled'], default: 'created' },
  paymentMethod: { type: String, enum: ['online_sber', 'upon_meeting'], required: true },
  paymentId: String, // ID платежа в системе Сбера (если online)
  deliveryMethod: { type: String, enum: ['yandex', 'cdek', 'pickup'], required: true },
  deliveryCost: Number,
  deliveryTrackNumber: String,
  totalAmount: Number,
  buyerNote: String,
  createdAt: Date,
  completedAt: Date
}

// Модель UserRating (Рейтинг пользователя) - интегрируется с общей моделью User
// Можно добавить поля в модель User:
{
  // ... существующие поля ...
  rating: {
    totalScore: Number,      // Сумма всех оценок
    reviewCount: Number,     // Количество отзывов
    dealsCompleted: Number   // Количество завершённых сделок
  }
}

// Модель Review (Отзыв по сделке)
{
  _id: ObjectId,
  orderId: ObjectId,
  authorId: ObjectId,       // Кто оставил отзыв
  targetId: ObjectId,       // Кому оставили отзыв
  rating: Number,           // 1-5
  text: String,
  type: { type: String, enum: ['seller', 'buyer'] }, // Роль оцениваемого в этой сделке
  createdAt: Date
}
```

4. API-эндпоинты и заглушки

Все эндпоинты по пути /api/market/ и /api/orders/.

· POST /api/market/items — Создать объявление.
· GET /api/market/items — Список с фильтрами по location.city, category, type.
· POST /api/orders — Создать заказ (корзина). В запросе передаются itemId, paymentMethod, deliveryMethod.
· POST /api/payments/sber/create — Инициировать платёж в Сбере. Ответ: { paymentUrl: 'https://securepayments.sberbank.ru/...' }.
· POST /api/delivery/calculate — Рассчитать стоимость доставки. Запрос: { deliveryMethod: 'yandex|cdek', cityFrom, cityTo, itemSpecs }.

Заглушка для расчёта доставки (фронтенд):

```javascript
const mockCalculateDelivery = async (request) => {
  console.log('Заглушка: Расчёт доставки для', request);
  // Фиксированная логика для демо
  if (request.deliveryMethod === 'yandex' && request.cityFrom === 'Екатеринбург') {
    return { cost: 250, estimatedDays: 1 };
  }
  if (request.deliveryMethod === 'cdek') {
    return { cost: 500, estimatedDays: 3 };
  }
  return { cost: 0, estimatedDays: null };
};
```

5. Интеграция с внешними сервисами

1. Сбербанк (эквайринг): Для приёма онлайн-платежей. Требуется регистрация бизнес-аккаунта в Сбере и настройка API.
2. API СДЭК: Для расчёта стоимости и создания накладных на межгород.
3. API Яндекс Доставки: Для расчёта и заказа доставки внутри Екатеринбурга.
4. (На будущее) Google Maps/Яндекс Карты: Для отображения точек самовывоза.

6. Система рейтинга (общая для сайта)

· Основа: Средний балл из всех полученных отзывов по сделкам.
· Визуализация: Отображается звездами (★ 4.8) рядом с логином пользователя везде на сайте (в ленте проектов, комментариях, профиле).
· Повышение рейтинга: За каждую завершённую сделку с отзывом. Дополнительные идеи для повышения (как вы хотели):
  · Полезный комментарий, отмеченный автором проекта (+0.1 к репутации).
  · Публикация популярного проекта в «Ленте» (+0.05 за 100 лайков).
  · Активная помощь в разделе «Ищут помощи» (решение проблемы).
· Важность: Высокий рейтинг повышает доверие, может давать преимущество в выдаче объявлений.

7. Пошаговый план реализации (Milestones)

1. Этап 1 (UI/Фронтенд): Создать интерфейс раздела «Барахолка» (Marketplace.tsx) с гридом товаров, формой публикации и модалкой оформления заказа с заглушками для всех API.
2. Этап 2 (Бэкенд-логика): Реализовать основные модели (MarketItem, Order, Review), эндпоинты для операций с товарами и заказами без реальных платежей и доставки.
3. Этап 3 (Интеграции): Поочерёдное подключение:
   · API СДЭК для расчёта доставки.
   · Яндекс Доставки.
   · Платёжного шлюза Сбербанка (самое сложное, требует тестового контура).
4. Этап 4 (Рейтинг и отладка): Внедрение системы рейтинга, уведомлений, отладка полного цикла сделки.

8. Ключевые технические риски и вопросы

· Эскроу-счета: Для безопасных платежей «онлайн» нужен юридический статус (ИП/ООО) и договор с эквайером (Сбером) на escrow. Альтернатива — платежи напрямую продавцу, но это менее безопасно.
· Комиссия: За онлайн-платежи Сбер берёт комиссию (~2-3%). Кто её платит? Обычно продавец, она может быть включена в цену.
· Ответственность за доставку: Нужно четко прописать в «Правилах», что за сохранность товара в пути до момента получения отвечает продавец (он выбирает службу и страховку).

4. "Библиотека" - кнопка отрывающая интерфейс через который пользователь сможет загрузить, скачать, распечатать файлы в различных самых ходовых форматах. TXT,PDF,GPEG,WORD и т.д.
за выложенные документы будут начисляться баллы в рейтинг пользователя
5."Ищут помощи"- кнопка при нажатии на которую будет открываться окно с запросами от пользователя на помощь в том или ином вопросе, желание получить совет или инструкцию, за помощь 
тоже начисляються баллы в рейтинг пользователя. Размещаться запросы на помощь будут из раздела "Моя мастерская" кнопка "помощь" в ней будет форма для заполнения которая уже с 
данными будет появляться на доске обьявлений в разделе "Ищу помощь"
6. "Достижения"-раздел при нажатии на кнопку открывает модольное окно с прокруткой рейтинга пользователей 
7. "Мои беседы"- кнопка открывающая чаты пользователя которые он начал с другими пользователями под их проектом, то есть рассматривая в "ленте проектов" чей либо проект изадав вопрос 
в специальном разделе после закрыпия этого проекта в "ленте проектов" он сохраняеться для пользователя в нем как в архиве, что бы потом можно было легко найти и задать необходимые вопросы
или на них ответить.
8. "Мастера рядом"- в этот раздел будут попадать мастера выполняющие заказы через сайт с высоким рейтингом и реално работающие  своими руками или продающие через сайт. Как рекламный ход.
9. "Лента проектов"- страница в которой будут несколько разделов и направлений "Механика" "Электро-механика" Электротехника" "Робототехника" "Столярка" Слесарка" "Кулинария" 
"Шитье" "Рукоделие" "Разное" где будет можно полистать интересующие проекты.
10.