/**
 * utils/profanity-list.ts
 * Список нецензурных слов и выражений для модерации
 * Разбит по категориям для возможной будущей градации нарушений
 */

// Основные матерные корни (для поиска в составе слов)
export const profanityRoots: string[] = [
  // Русский мат
  'хуй', 'хуё', 'хуя', 'хуе', 'хую', 'хуи',
  'пизд', 'пизд', 'пезд', 'пёзд',
  'бля', 'бляд', 'блят',
  'ебл', 'еба', 'ебу', 'еби', 'ёб', 'ёба',
  'пидор', 'пидар', 'пидр',
  'мудак', 'мудил', 'мудозв',
  'гандон', 'гандон',
  'шлюх', 'шлюш',
  'сука', 'суки', 'сук',
  'мразь', 'мрази',
  'тварь', 'твари',
  'курва',
  'долбоёб', 'долбоеб',
  'ублюд',
  'залуп',
  'петух', 'петуша', // в переносном смысле
  'сперм',
  'разъеба', 'разьеба',
  'заеба', 'заебо',
  'нахуй', 'нахи',
  'пох', 'поху',
  'ахуе', 'ахине',
  
  // Английский мат
  'fuck', 'fuk', 'fuc',
  'shit', 'shet',
  'bitch', 'bich',
  'asshole', 'asshol',
  'cunt',
  'dick',
  'pussy',
  'motherfucker', 'mothafucka',
  'nigger', 'nigga', // расовые оскорбления
];

// Полные слова (для точного совпадения)
export const profanityExact: string[] = [
  // Русский мат
  'хуй', 'хуя', 'хуе', 'хую', 'хуи',
  'пизда', 'пизде', 'пизду', 'пизды', 'пиздой',
  'блядь', 'блять', 'бляди', 'блядство',
  'ебан', 'ебаный', 'ебать', 'ебаться',
  'пидор', 'пидарас', 'пидорас',
  'мудак', 'мудацкий',
  'гандон',
  'шлюха',
  'сука', 'сукин',
  'мразь',
  'тварь',
  'курва',
  'долбоеб', 'долбоёб',
  'ублюдок',
  'залупа',
  'петух', // в переносном смысле
  
  // Английский мат
  'fuck', 'fucker', 'fucking',
  'shit', 'shitter',
  'bitch', 'bitching',
  'asshole',
  'cunt',
  'dick', 'dickhead',
  'pussy',
  'motherfucker',
];

// Слова, которые могут давать ложные срабатывания
export const profanityFalsePositive: string[] = [
  // Русские слова, содержащие матерные корни
  'хуйня', // может быть нормальным словом в контексте "ерунда"
  'хер', // замена мата, но не мат
  'фиг', // замена мата, но не мат
  'блин', // замена мата, но не мат
  
  // Английские слова, совпадающие с матом
  'bitch', // трудный случай, нужно по контексту
];

// Регулярные выражения для поиска с учетом замены букв
export const profanityPatterns: RegExp[] = [
  // Замена букв цифрами или похожими символами
  /ху[1i!еeёo0яa]/i,  // хyi, хy!e, хуё, хуя
  /п[1i!]зд/i,         // пiзд, п!зд
  /бл[1i!я]/i,         // бля, блi, бл!
  /[еe]б[аaуy]/i,      // еба, eбa, ебу, eбy
  /[pр][i1][дd]/i,     // pid, p1d (пид)
  /[сc][уy][кk][аa]/i, // suka, cyka, сyкa
  
  // Транслит
  /hu[i1y]/i,          // хуй через транслит
  /p[i1]zd/i,          // пизд через транслит
  /bl[a1i]/i,          // бля через транслит
  /eb[a1u]/i,          // еба через транслит
];

/**
 * Функция для проверки наличия мата в тексте
 * @param text - текст для проверки
 * @returns true если найден мат
 */
export function containsProfanity(text: string): boolean {
  const lowerText = text.toLowerCase();
  
  // Проверка на точное совпадение слов
  for (const word of profanityExact) {
    // Ищем слово как отдельное (окруженное пробелами или знаками препинания)
    const regex = new RegExp(`\\b${word}\\b`, 'i');
    if (regex.test(text)) {
      return true;
    }
  }
  
  // Проверка на корни слов
  for (const root of profanityRoots) {
    if (lowerText.includes(root.toLowerCase())) {
      // Дополнительная проверка на ложные срабатывания
      let isFalsePositive = false;
      for (const fp of profanityFalsePositive) {
        if (lowerText.includes(fp)) {
          isFalsePositive = true;
          break;
        }
      }
      if (!isFalsePositive) {
        return true;
      }
    }
  }
  
  // Проверка по паттернам с заменой букв
  for (const pattern of profanityPatterns) {
    if (pattern.test(text)) {
      return true;
    }
  }
  
  return false;
}